[
  {
    "title": "Entidade: regras de neg√≥cio puras",
    "description": "Entidade √© uma fun√ß√£o/type pura. Sem React, sem fetch, sem side-effects.",
    "code": "// domain/entities/order.ts\n// ‚úÖ Entidade pura ‚Äî zero depend√™ncias externas\n\nexport interface OrderItem {\n  productId: string;\n  name: string;\n  price: number;\n  quantity: number;\n}\n\nexport interface Order {\n  id: string;\n  items: OrderItem[];\n  status: 'draft' | 'confirmed' | 'shipped' | 'delivered';\n  createdAt: Date;\n}\n\n// Regras de neg√≥cio vivem AQUI, n√£o no componente\nexport function calculateTotal(order: Order): number {\n  return order.items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n}\n\nexport function canCancel(order: Order): boolean {\n  return order.status === 'draft' || order.status === 'confirmed';\n}\n\nexport function canShip(order: Order): boolean {\n  return order.status === 'confirmed' && order.items.length > 0;\n}\n\n// Test√°vel sem React, sem mocks, sem setup\n// test: expect(calculateTotal(mockOrder)).toBe(150)"
  },
  {
    "title": "Use Case como custom hook",
    "description": "A tens√£o real: Clean Architecture diz 'classes com DI', React diz 'hooks com closures'. A solu√ß√£o pr√°tica.",
    "code": "// application/use-cases/useCreateOrder.ts\n// O use case √© um hook que orquestra entities + ports\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport type { Order, OrderItem } from '../../domain/entities/order';\nimport type { OrderRepository } from '../../domain/ports/orderRepository';\n\n// Port: interface que define o que o use case precisa\n// (equivalente √† interface do reposit√≥rio no Clean Architecture cl√°ssico)\nexport type { OrderRepository };\n\n// Use case como hook ‚Äî composable, test√°vel, React-friendly\nexport function useCreateOrder(repo: OrderRepository) {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (items: OrderItem[]) => {\n      // Regras de neg√≥cio da entidade\n      if (items.length === 0) throw new Error('Pedido vazio');\n      if (items.some(i => i.quantity <= 0)) throw new Error('Quantidade inv√°lida');\n\n      // Delega ao reposit√≥rio (adapter)\n      return repo.create({ items });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['orders'] });\n    },\n  });\n}\n\n// ‚ö†Ô∏è A tens√£o: Clean Architecture quer DI via constructor,\n// mas hooks n√£o t√™m constructors. A solu√ß√£o: receber o repo\n// como par√¢metro ou via Context."
  },
  {
    "title": "Port + Adapter (Repository pattern com React)",
    "description": "Port define a interface, Adapter implementa. No React, o adapter √© injetado via props ou Context.",
    "code": "// domain/ports/orderRepository.ts (PORT - s√≥ interface)\nexport interface OrderRepository {\n  create(data: { items: OrderItem[] }): Promise<Order>;\n  findById(id: string): Promise<Order>;\n  list(): Promise<Order[]>;\n}\n\n// infrastructure/adapters/httpOrderRepository.ts (ADAPTER)\nexport function createHttpOrderRepository(baseUrl: string): OrderRepository {\n  return {\n    create: async (data) => {\n      const res = await fetch(`${baseUrl}/orders`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n      return res.json();\n    },\n    findById: async (id) => {\n      const res = await fetch(`${baseUrl}/orders/${id}`);\n      return res.json();\n    },\n    list: async () => {\n      const res = await fetch(`${baseUrl}/orders`);\n      return res.json();\n    },\n  };\n}\n\n// infrastructure/adapters/mockOrderRepository.ts (ADAPTER para testes)\nexport function createMockOrderRepository(): OrderRepository {\n  const orders: Order[] = [];\n  return {\n    create: async (data) => {\n      const order = { id: crypto.randomUUID(), ...data, status: 'draft' as const, createdAt: new Date() };\n      orders.push(order);\n      return order;\n    },\n    findById: async (id) => orders.find(o => o.id === id)!,\n    list: async () => [...orders],\n  };\n}"
  },
  {
    "title": "DI no React: Context como Service Locator",
    "description": "Como injetar depend√™ncias no React sem classes. Context + factory functions.",
    "code": "// infrastructure/di/DependencyProvider.tsx\nimport { createContext, useContext, useMemo } from 'react';\nimport type { OrderRepository } from '../../domain/ports/orderRepository';\nimport { createHttpOrderRepository } from '../adapters/httpOrderRepository';\n\ninterface Dependencies {\n  orderRepo: OrderRepository;\n  // authRepo: AuthRepository;\n  // analyticsService: AnalyticsService;\n}\n\nconst DepsContext = createContext<Dependencies | null>(null);\n\nexport function DependencyProvider({ children }: { children: React.ReactNode }) {\n  const deps = useMemo<Dependencies>(() => ({\n    orderRepo: createHttpOrderRepository(import.meta.env.VITE_API_URL),\n  }), []);\n\n  return <DepsContext.Provider value={deps}>{children}</DepsContext.Provider>;\n}\n\n// Hook tipado para acessar depend√™ncias\nexport function useDeps(): Dependencies {\n  const ctx = useContext(DepsContext);\n  if (!ctx) throw new Error('useDeps must be used within DependencyProvider');\n  return ctx;\n}\n\n// Uso no componente:\nfunction OrderPage() {\n  const { orderRepo } = useDeps();\n  const createOrder = useCreateOrder(orderRepo);\n  // ...\n}\n\n// Em testes:\nfunction renderWithMockDeps(ui: ReactElement) {\n  return render(\n    <DependencyProvider deps={{ orderRepo: createMockOrderRepository() }}>\n      {ui}\n    </DependencyProvider>\n  );\n}"
  },
  {
    "title": "‚ùå Over-engineering vs ‚úÖ Pragmatismo",
    "description": "Clean Architecture no frontend precisa de bom senso. Nem toda feature precisa de 5 camadas.",
    "code": "// ‚ùå OVER-ENGINEERING: CRUD simples com 5 camadas\n// entities/User.ts\n// ports/UserRepository.ts\n// use-cases/CreateUserUseCase.ts\n// adapters/HttpUserRepository.ts\n// components/CreateUserForm.tsx\n// ‚Üí 5 arquivos para um form de cadastro simples\n\n// ‚úÖ PRAGM√ÅTICO: use as camadas quando fazem sentido\n\n// Para CRUDs simples ‚Äî React Query direto\nfunction useUsers() {\n  return useQuery({ queryKey: ['users'], queryFn: () => api.get('/users') });\n}\n\n// Para features com regras de neg√≥cio ‚Äî adicione entidade\nfunction useCheckout() {\n  const { orderRepo } = useDeps();\n  // Regra de neg√≥cio justifica a camada extra\n  return useMutation({\n    mutationFn: async (cart: CartItem[]) => {\n      const total = calculateTotal(cart);\n      if (total < MIN_ORDER_VALUE) throw new Error('Pedido m√≠nimo R$50');\n      if (!hasStock(cart)) throw new Error('Sem estoque');\n      return orderRepo.create({ items: cart, total });\n    },\n  });\n}\n\n// üéØ Regra de ouro: se a l√≥gica de neg√≥cio cabe em 3 linhas,\n// n√£o precisa de use case separado. Se tem valida√ß√£o, c√°lculo,\n// ou orquestra√ß√£o de m√∫ltiplos servi√ßos, a√≠ sim."
  },
  {
    "title": "Estrutura de pastas (feature-based)",
    "description": "Organize por feature, n√£o por camada t√©cnica. Cada feature cont√©m suas pr√≥prias camadas.",
    "code": "// ‚úÖ Feature-based (escala melhor)\nsrc/\n  features/\n    orders/\n      domain/           # Entidades e regras\n        entities.ts     # Order, OrderItem, calculateTotal\n        ports.ts        # OrderRepository interface\n      application/      # Use cases como hooks\n        useCreateOrder.ts\n        useOrderList.ts\n      infrastructure/   # Adapters\n        httpOrderRepo.ts\n        mockOrderRepo.ts\n      ui/               # Componentes React\n        OrderList.tsx\n        OrderForm.tsx\n        OrderCard.tsx\n    auth/\n      domain/\n      application/\n      infrastructure/\n      ui/\n  shared/               # C√≥digo compartilhado\n    ui/                 # Design system components\n    hooks/              # Hooks gen√©ricos\n    infrastructure/     # API client base, error handling\n\n// ‚ùå Layer-based (dif√≠cil de navegar com 50+ features)\nsrc/\n  entities/\n    order.ts\n    user.ts\n    product.ts     # ‚Üí Todos misturados\n  use-cases/\n    createOrder.ts\n    createUser.ts  # ‚Üí Sem contexto de feature"
  }
]
